#!/bin/bash

set -ex

source ~/.zshenv

#pushd /home/jlewallen/jlewallen/weekly-playlist
#if [ -f weekly ]; then
	#./weekly --eclectic-only
#fi
#popd

pushd /home/jlewallen/jlewallen/playlist-generator
if [ -f generator ]; then
	./generator
popd
popd

pushd ~jlewallen/jlewallen/spotify

pushd data/jlewallen.github.io/music/data
git pull
popd

docker start some-redis || true
docker build -t spotify .
docker run --name spotify -v ~jlewallen/jlewallen/spotify/data:/app/data --rm --link some-redis:redis spotify

pushd data/jlewallen.github.io/music/data
git add . && git commit -av -m 'Updating playlists.' && git push origin
popd

popd
